@page "/subestados"
@using OUT_APP_EQUIPGO.Components.Shared

<div class="frame-container">
    <!-- ENCABEZADO -->
    <div class="dashboard-parent">
        <b class="dashboard-equipgo">Subestados</b>
        <div class="logo-os">
            <img class="dashboard-vector-icon" alt="Logo" src="img/logoOutsourcing.png" />
        </div>
    </div>

    <!-- CONTENIDO PRINCIPAL -->
    <div class="contenido">
        <!-- FILTROS -->
        <div class="dashboard-filtros" id="subestadosFiltros">
            <div class="dashboard-filtro">
                <!-- Filtro por Nombre del Subestado -->
                <div class="buscar-nombre">
                    <b class="dashboard-equipgo">Nombre del Subestado</b>
                    <div class="frame-div">
                        <div class="placeholder-wrapper">
                            <input type="text"
                                   class="placeholder"
                                   @bind="filtroNombre"
                                   @oninput="OnFiltroNombreChanged"
                                   data-filtro="nombre"
                                   placeholder="Buscar por nombre..." />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Botón para añadir subestado -->
        <div class="botonera">
            <button class="botn3" data-bs-toggle="modal" data-bs-target="#modalCrearSubEstado">
                 Añadir Subestado
            </button>
        </div>

        <!-- Tabla de subestados -->
        @if (isCargandoSubEstados)
        {
            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 50; pointer-events: none;">
                <div style="position: relative; width: 56px; height: 56px;">
                    <div style="width: 56px; height: 56px; border: 4px solid #ef4444; border-top-color: transparent; border-radius: 50%; animation: spin-slow 1.4s linear infinite;"></div>
                </div>
                <p style="margin-top: 12px; color: #ef4444; font-size: 18px; font-weight: 600; letter-spacing: 0.025em; animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;">
                    Cargando subestados...
                </p>
            </div>
        }
        else if (!subEstadosPaginados.Any())
        {
            <p>No hay subestados que coincidan con los filtros.</p>
        }
        else
        {
            <div class="table-wrapper">
                <table class="table-equipgo">
                    <thead>
                        <tr>
                            <th>Nombre del Subestado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var sub in subEstadosPaginados)
                        {
                            <tr>
                                <td>@sub.NombreSubEstado</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary" onclick="editarSubEstado(@sub.Id)">✏️</button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="abrirModalEliminarSubEstado(@sub.Id)">🗑️</button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- COMPONENTE DE PAGINACIÓN -->
            <Paginacion TotalRegistros="@subEstadosFiltrados.Count"
                        PaginaActual="@paginaActual"
                        PaginaActualChanged="@OnPaginaCambiada"
                        RegistrosPorPagina="@registrosPorPagina"
                        RegistrosPorPaginaChanged="@OnRegistrosPorPaginaCambiados"
                        ModoAuto="@modoAuto"
                        ModoAutoChanged="@OnModoAutoCambiado" />
        }
    </div>
</div>

<!-- Modal para crear subestado -->
<div class="modal fade modal-equipgo" id="modalCrearSubEstado" tabindex="-1" aria-labelledby="modalCrearSubEstadoLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header-equipgo">
                <h5 class="modal-title-equipgo" id="modalCrearSubEstadoLabel">Registrar Subestado</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body-equipgo">
                <form id="formCrearSubEstado">
                    <div class="seccion-modal">
                        <div class="seccion-header">
                            <span class="seccion-titulo">📝 Información del Subestado</span>
                        </div>
                        <div class="seccion-datos">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-section">
                                        <label for="nombre" class="form-label">Nombre del Subestado</label>
                                        <input type="text" class="form-control" id="nombre" name="nombre" required />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer-equipgo">
                <button type="button" class="boton-modal-equipgo boton-modal-secundario" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="boton-modal-equipgo" onclick="guardarSubEstado()">Guardar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal editar -->
<div class="modal fade modal-equipgo" id="modalEditarSubEstado" tabindex="-1" aria-labelledby="modalEditarSubEstadoLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header-equipgo">
                <h5 class="modal-title-equipgo" id="modalEditarSubEstadoLabel">Editar Subestado</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body-equipgo">
                <form id="formEditarSubEstado">
                    <input type="hidden" id="editarId" />
                    <div class="seccion-modal">
                        <div class="seccion-header">
                            <span class="seccion-titulo">📝 Información del Subestado</span>
                        </div>
                        <div class="seccion-datos">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-section">
                                        <label for="editarNombreSubEstado" class="form-label">Nombre del Subestado</label>
                                        <input type="text" class="form-control" id="editarNombreSubEstado" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer-equipgo">
                <button type="button" class="boton-modal-equipgo boton-modal-secundario" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="boton-modal-equipgo" onclick="guardarCambiosSubEstado()">Guardar Cambios</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal eliminar -->
<div class="modal fade modal-equipgo" id="modalEliminarSubEstado" tabindex="-1" aria-labelledby="modalEliminarSubEstadoLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header-equipgo">
                <h5 class="modal-title-equipgo" id="modalEliminarSubEstadoLabel">Confirmar eliminación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body-equipgo">
                ¿Estás seguro de que deseas eliminar este subestado?
            </div>
            <div class="modal-footer-equipgo">
                <button type="button" class="boton-modal-equipgo boton-modal-secundario" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="boton-modal-equipgo" style="background-color: #dc3545; border-color: #dc3545;" onclick="confirmarEliminarSubEstado()">Eliminar</button>
            </div>
        </div>
    </div>
</div>

<style>
    @@keyframes spin-slow {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    @@keyframes pulse {
        0%, 100% {
            opacity: 1;
        }

        50% {
            opacity: 0.5;
        }
    }
</style>